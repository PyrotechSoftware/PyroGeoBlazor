@namespace PyroGeoBlazor.DeckGL.Components
@using MudBlazor.Extensions.Options
@using MudBlazor.Utilities
@using PyroGeoBlazor.DeckGL.Models
@using PyroGeoBlazor.Utilities

@if (Layers != null && Layers.Any())
{
    <MudDropContainer T="LayerConfig" Items="LayersReverse" ItemsSelector="@((item, dropzone) => true )" Class="d-flex flex-column" ItemDropped="@(OnDropHandler)" Style="height:100%; box-sizing:border-box;">
        <ChildContent>
            <MudTreeView T="LayerConfig" Dense Class="d-flex-column mud-height-full" ReadOnly="false" Hover="true" ExpandOnClick="false">
                <MudDropZone T="LayerConfig" Identifier="contents" Class="flex-grow-1" AllowReorder />
            </MudTreeView>
        </ChildContent>
        <ItemRenderer>
            <MudTreeViewItem T="LayerConfig" Expanded ExpandButtonIcon="@(context.Type == "TileLayer" ? "" : Icons.Material.Outlined.KeyboardArrowRight)">
                <BodyContent Context="item">
                    <MudMenu PositionAtCursor FullWidth ActivationEvent="@MouseEvent.RightClick">
                        <ActivatorContent>
                            <MudStack Row AlignItems="AlignItems.Center" Spacing="2">
                                <MudCheckBox T="bool"
                                             Value="@context.Visible"
                                             ValueChanged="@(async (bool newValue) => await OnVisibilityToggled(context.Id, newValue))"
                                             Color="Color.Primary"
                                             Disabled="@IsLocked" />
                                <MudText Typo="Typo.body2" Style="flex: 1;">
                                    @context.Id
                                </MudText>
                            </MudStack>
                        </ActivatorContent>
                        <ChildContent>
                            <MudMenuItem OnClick="@(async () => { await OnLayerZoomTo(context); })" 
                                         Icon="@Icons.Material.Filled.ZoomIn">
                                Zoom to Layer
                            </MudMenuItem>
                            <MudMenuItem OnClick="@(() => { OnDataDesign(context); })"
                                         Icon="@Icons.Material.Filled.Edit"
                                         Disabled="true">
                                Data Design
                            </MudMenuItem>
                            <MudMenuItem OnClick="@(async () => { await OnToggleLabel(context); })"
                                         Icon="@Icons.Material.Filled.Label"
                                         Disabled="@(!HasLabelSupport(context))">
                                @(context.LabelConfig?.Enabled == true ? "Hide Labels" : "Show Labels")
                            </MudMenuItem>
                        </ChildContent>
                    </MudMenu>
                </BodyContent>
                <ChildContent>
                    @if (context.Type != "TileLayer")
                    {
                        <MudTreeViewItem T="string">
                            <BodyContent Context="layerContext">
                                <MudTooltip Text="@(IsLocked ? "Layer control is locked" : "Adjust Symbology")" Delay="500">
                                    <MudIconButton Icon="@Icons.Material.Filled.Square" 
                                                   Style="@($"color: {GetLayerColor(context)}")" 
                                                   Size="Size.Large"
                                                   Disabled="@IsLocked"
                                                   OnClick="@(() => OpenColorPicker(context))" />
                                </MudTooltip>
                            </BodyContent>
                        </MudTreeViewItem>
                    }
                </ChildContent>
            </MudTreeViewItem>
        </ItemRenderer>
    </MudDropContainer>
}
else
{
    <MudText Typo="Typo.body2" Color="Color.Secondary" Class="pa-2">
        No layers
    </MudText>
}

