@page "/vector-tiles"
@using PyroGeoBlazor.Demo.Models
@using PyroGeoBlazor.Leaflet.Components
@using PyroGeoBlazor.Leaflet.Models
@using PyroGeoBlazor.Models
@using PyroGeoBlazor.Components

<PageTitle>Vector Tiles - PyroGeoBlazor Demo</PageTitle>

<div style="display: flex; flex-direction: row; height: 100%; overflow: hidden;">
    <div style="flex: 0 0 30%; overflow-y: auto; overflow-x: hidden;">
        <MudContainer MaxWidth="MaxWidth.False" Class="pa-4">
            <MudText Typo="Typo.h4" Class="mb-2">Vector Tiles</MudText>
            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">High-performance rendering with interactive features, selection, and dynamic styling</MudText>

            <MudCard Class="mb-3">
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Layer Selector</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <WmtsLayerSelector InitialUrl="https://lims.koleta.co.mz/geoserver/PlannerSpatial/gwc/service/wmts?REQUEST=GetCapabilities"
                                       InitialVersion="1.1.1"
                                       OnUrlTemplateGenerated="HandleUrlTemplateGenerated" />
                </MudCardContent>
            </MudCard>

            <LayerStyle Style="@currentLayerStyle" ApplyStyle="@HandleApplyStyle" />

            <MudCard Class="mb-3">
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Layer Options</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.body2" Class="mb-2">Configure layer behavior before adding</MudText>
                    <MudDivider Class="my-2" />
                    <MudStack Spacing="1">
                        <MudSwitch T="bool" Color="Color.Primary" Label="@($"Interactive ({(isInteractive ? "On" : "Off")})")"
                                   @bind-Value="@isInteractive" />
                        <MudSwitch T="bool" Color="Color.Primary" Label="@($"Selection ({(selectionEnabled ? "On" : "Off")})")"
                                   @bind-Value="@selectionEnabled" 
                                   Disabled="@(!isInteractive)" />
                        <MudSwitch T="bool" Color="Color.Primary" Label="@($"Multi-Select ({(multiSelectEnabled ? "On" : "Off")})")"
                                   @bind-Value="@multiSelectEnabled" 
                                   Disabled="@(!selectionEnabled)" />
                    </MudStack>

                    @if (loadedLayers.Count > 0)
                    {
                        <MudButton Variant="Variant.Outlined" Color="Color.Error" Size="Size.Small" FullWidth="true"
                                   StartIcon="@Icons.Material.Filled.Clear"
                                   OnClick="ClearSelection"
                                   Disabled="@(!selectionEnabled)"
                                   Class="mt-2">
                            Clear Selection
                        </MudButton>
                    }
                </MudCardContent>
            </MudCard>

            @if (loadedLayers.Count > 0)
            {
                <MudCard Class="mb-3">
                    <MudCardHeader>
                        <MudText Typo="Typo.h6">Layer Manager (@loadedLayers.Count)</MudText>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudList Dense="true" T="string">
                            @for (int i = loadedLayers.Count - 1; i >= 0; i--)
                            {
                                var index = i;
                                var layerName = loadedLayers[index];
                                var isTop = index == loadedLayers.Count - 1;
                                var isBottom = index == 0;
                                
                                <MudListItem>
                                    <MudStack Row AlignItems="AlignItems.Center" Spacing="1">
                                        <MudStack Spacing="0" Style="min-width: 40px;">
                                            <MudIconButton Icon="@Icons.Material.Filled.ArrowUpward" 
                                                          Size="Size.Small" 
                                                          Disabled="@isTop"
                                                          OnClick="@(() => MoveLayerUp(layerName))"
                                                          Title="Move layer up" />
                                            <MudIconButton Icon="@Icons.Material.Filled.ArrowDownward" 
                                                          Size="Size.Small" 
                                                          Disabled="@isBottom"
                                                          OnClick="@(() => MoveLayerDown(layerName))"
                                                          Title="Move layer down" />
                                        </MudStack>
                                        <MudText Typo="Typo.body2" Style="flex: 1;">@layerName</MudText>
                                        <MudIconButton Icon="@Icons.Material.Filled.Delete" 
                                                      Size="Size.Small" 
                                                      Color="Color.Error"
                                                      OnClick="@(() => RemoveLayerByName(layerName))"
                                                      Title="Remove layer" />
                                    </MudStack>
                                </MudListItem>
                            }
                        </MudList>
                    </MudCardContent>
                </MudCard>
            }

            <MudCard Class="mb-3">
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Features</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudList Dense="true" T="string">
                        <MudListItem>Interactive hover effects</MudListItem>
                        <MudListItem>Feature selection</MudListItem>
                        <MudListItem>Multi-segment support</MudListItem>
                        <MudListItem>Dynamic styling</MudListItem>
                        <MudListItem>Runtime control</MudListItem>
                    </MudList>
                </MudCardContent>
            </MudCard>

            <MudCard Class="mb-3">
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Vector Tile Layers</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudText Typo="Typo.body2">
                        <strong>Format:</strong> Mapbox Vector Tiles (PBF)<br/>
                        <strong>Protocol:</strong> WMTS<br/>
                        <strong>Layers:</strong> Townships, Extensions, Parcels<br/>
                        <strong>Styling:</strong> Dynamic per layer<br/>
                        <strong>Selection:</strong> Multi-feature support
                    </MudText>
                </MudCardContent>
            </MudCard>

            <MudButton Variant="Variant.Text" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowBack" Href="/" Class="mt-3">
                Back to Home
            </MudButton>
        </MudContainer>
    </div>

    <div style="flex: 1 1 70%; min-width: 0; overflow: hidden; position: relative;">
        <LeafletMap Height="100%" Map="PositionMap" TileLayer="OpenStreetMapsTileLayer" Controls="MapControls" />

        
    </div>
</div>
